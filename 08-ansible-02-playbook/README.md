# 08.02 Работа с Playbook  

Исходник плейбука [здесь](playbook/site.yml).  
  
Playbook имеет три play, это установка java, elasticsearch и kibana. Параметр `hosts` указывает на каких хостах запускать 
таски. Каждая таска имеет тег в соответствии со своим play (ключ tags), т.е. имеются теги java, elastic и kibana.  
  
Таски для play Java:  
* Установка переменной `java_home`, которая содержит путь к домашней директории java, с помощью `set_fact`. 
* С помощью модуля `copy` копируем архив java с control node на управляемую ноду. `register` - записываем результат выполнения
в переменную и `until` - выполняем задачу до тех пор (по умолчанию 3 попытки), пока значение переменной не будет успех, 
т.е. ожидаем успешного выполнения задачи.  
* Модуль `file` проверяет, существует ли директория по указанному пути, если нет то создаем ее. 
* Разархивируем архив в подготовленную директорию с помощью модуля `unarchive`, параметр `copy: false` указывает на то, 
чтобы искать src архив на управляемой ноде, параметр `creates` говорит о том что если файл по указанному пути существует, 
то шаг выполнятся не будет. 
* Экспортируем переменные среды с помощью модуля `template`, заранее подготовленный шаблон в папке `templates` в формате 
Jinja2 заливается в `/etc/profile.d/`.  

Там где нужны привилегии root используется `become: true`. На создаваемые файлы и директории устанавливаем права с помощью `mode`.  
Для elasticsearch и kibana, те же шаги, только вместо `copy` для загрузки установочного архива используем модуль `get_url`. 
В котором параметр `force: true` - файл будет скачиваться каждый раз и заменяться при изменении содержимого, `validate_certs` - 
будет ли проверяться ssl сертификат, `timeout` - таймаут в секундах на url запрос.